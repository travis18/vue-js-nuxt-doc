# 7. Async/Await & é€²åº¦æ¢

åœ¨æœ¬ç« ç¯€ä¸­æˆ‘å€‘æœƒç¹¼çºŒæ‰“é€  API å‘¼å«ï¼Œé¦–å…ˆä½¿ç”¨çš„æ˜¯ Nuxt æ‡‰ç”¨ç¨‹å¼å¸¸è¦‹çš„ Async/Awaitã€‚æ¥è‘—å†æ‰“é€  event æ´»å‹•é¡¯ç¤ºé é¢ï¼Œåœ¨æˆ‘å€‘ç€è¦½æŒ‡å®šæ´»å‹•å¦‚ `/event/1` æ™‚åŠ å…¥é¡å¤–çš„ API å‘¼å«ã€‚æœ€å¾Œå†åŠ å…¥é€²åº¦æ¢çš„åŠŸèƒ½ã€‚

## Async/Await

åœ¨å‰ä¸€å€‹ç« ç¯€ï¼Œæˆ‘å€‘çš„ API ç¨‹å¼ç¢¼çœ‹èµ·ä¾†åƒä¸‹é¢é€™æ¨£ï¼š

![](assets/Ch07/01.jpg)

ç„¶è€Œï¼Œä½¿ç”¨ `promise` æ­é… `then` æ™‚ï¼Œç¨‹å¼ç¢¼åœ¨é€²è¡Œä¸€å †å·¢ç‹€å‘¼å«çš„æ™‚å€™æœƒé–‹å§‹é™·å…¥åƒä¸‹åœ–é‚£æ¨£çš„æ··äº‚ï¼š

![](assets/Ch07/02.jpg)

å°±å¦‚ä½ æ‰€è¦‹ï¼Œåœ¨ç¨‹å¼ç¢¼ä¸­ç”¨ä¸€å †å·¢ç‹€çš„ `then` å¯èƒ½ä¸æ˜¯å¤ªå„ªã€‚åœ¨å®Œç¾ä¸–ç•Œä¸­æˆ‘å€‘æ‡‰è©²æœ‰äº›å¯ä»¥è®“ç¨‹å¼ç¢¼ä¸è®Šå¾—å·¢ç‹€çš„æ–¹æ³•ï¼Œæˆ–è¨±çœ‹èµ·ä¾†åƒä¸‹é¢é€™æ¨£ï¼š

![](assets/Ch07/03.jpg)

ä¸éé€™æ¨£çš„ç¨‹å¼ç¢¼æ˜¯æ²’æ³•è·‘çš„ã€‚é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼éœ€è¦ç”¨åˆ° `async/await` çš„åŸå› ï¼Œåˆ©ç”¨é€™å…©ç¨®èªæ³•ä¾†è·‘é€™é¡çš„ç¨‹å¼ã€‚

![](assets/Ch07/04.jpg)

é‚£é€™æ¨£åŸä¾†åœ¨ API ä¸­çš„ `then` è¦æ€éº¼é‡å¯«æˆ `async/await` å‘¢ï¼Ÿ åƒä¸‹é¢é€™æ¨£ï¼š

![](assets/Ch07/05.jpg)

è—‰ç”± ES6 è§£æ§‹èªæ³•ï¼Œæˆ‘å€‘é‚„å¯ä»¥å†ç°¡åŒ–æˆä¸‹é¢é€™æ¨£ï¼š

```javascript
      async asyncData({ $axios }) {
        const { data } = await $axios.get('http://localhost:3000/events')
        return {
          events: data
        }
      },
```

ç¾åœ¨æˆ‘å€‘å¯ä»¥ç”¨æ¨™æº–çš„ `try` å’Œ `catch` å€å¡ŠæŠŠéŒ¯èª¤è™•ç†åŠ å›ç¨‹å¼ç¢¼ä¸­ï¼Œå°±åƒä¸‹é¢é€™æ¨£ï¼š

```javascript
      async asyncData({ $axios, error }) {
        try {
          const { data } = await $axios.get('http://localhost:3000/events')
          return {
            events: data
          }
        } catch (e) {
          error({
            statusCode: 503,
            message: 'Unable to fetch events events at this time'
          })
        }
      },
```

ä½¿ç”¨é€™å€‹èªæ³•ä¸¦ä¸æœƒæ¯”ç”¨ `promise` å’Œ `then` æ•ˆèƒ½ä¾†çš„æ›´å¥½ï¼Œå®ƒåªæ˜¯ä¸€å€‹ç¨‹å¼ç¢¼å‘ˆç¾çš„æ–¹å¼ã€‚ä½†æ˜¯åŠ å…¥æˆ‘å€‘çš„ç¨‹å¼ç¢¼è£¡é¢ç”¨äº†ä¸€å †å·¢ç‹€ `then` çš„æ™‚å€™ï¼Œç”¨ `async/await` å°±ä¸å¤±ç‚ºä¸€å€‹æ›´å¥½çš„é¸æ“‡äº†ã€‚

## ç‚ºæˆ‘å€‘çš„ Event æ´»å‹•é¡¯ç¤ºé é¢åŠ å…¥ API å‘¼å«

ç¾åœ¨æ˜¯æ™‚å€™åœ¨æˆ‘å€‘ç€è¦½åƒæ˜¯ `/event/1` æ´»å‹• id ç‚º 1 çš„ event æ´»å‹•æ™‚åŠ å…¥ API å‘¼å«äº†ã€‚æˆ‘å€‘æœƒåŠ å…¥ `async/await` ç¨‹å¼ç¢¼ä¾†å‘¼å« APIï¼Œç„¶å¾Œå†æ›´æ–° h1 æ¨™é¡Œä»¥åŠ SEO æ¨™ç±¤ã€‚

ğŸ“ƒ **/pages/event/_id.vue**

```javascript
    <template>
      <div>
        <h1>{{ event.title }}</h1>
      </div>
    </template>
    <script>
    export default {
      head() {
        return {
          title: this.event.title,
          meta: [
            {
              hid: 'description',
              name: 'description',
              content: 'What you need to know about ' + this.event.title
            }
          ]
        }
      },
      async asyncData({ $axios, error, params }) {
        try {
          const { data } = await $axios.get(
            'http://localhost:3000/events/' + params.id
          )
          return {
            event: data
          }
        } catch (e) {
          error({
            statusCode: 503,
            message: 'Unable to fetch event #' + params.id
          })
        }
      }
    }
    </script>
```

ç¾åœ¨è®“æˆ‘å€‘å›åˆ°ç€è¦½å™¨ï¼Œå¯ä»¥çœ‹åˆ°é é¢å¦‚æˆ‘å€‘æ‰€æƒ³è¦çš„æ–¹å¼å‘ˆç¾ï¼š

![](assets/Ch07/06.gif)

## å¯¦ä½œé€²åº¦æ¢

å¥½çš„ï¼Œæˆ‘å€‘é‚„æ²’åœ¨ app ä¸Šçœ‹åˆ°é€²åº¦æ¢åœ¨æˆ‘å€‘å‘¼å« API çš„æ™‚å€™é¡¯ç¤ºï¼Œ ä½†æ˜¯å…¶å¯¦å®ƒå·²ç¶“åœ¨é‹ä½œä¸­äº†ã€‚åªæ˜¯å› ç‚ºå®ƒæ˜¯ç™½è‰²è€Œä¸”åœ¨é é¢é ‚ç«¯æ‰€ä»¥çœ‹ä¸åˆ°ã€‚æˆ‘å€‘ä¾†ä¿®æ”¹ä¸€ä¸‹ `nuxt.config.js` æª”ä¾†è®“å®ƒè·‘å‡ºä¾†ã€‚

ğŸ“ƒ **/nuxt.config.js**

```
      ...
      /*
      ** Customize the progress-bar color
      */
      loading: { color: '#39b982' },
      ...
```

ç„¶å¾Œé †ä¾¿èª¿ä¸€ä¸‹ json server çš„è¨­å®šï¼Œå¢åŠ  2000 æ¯«ç§’å»¶é²é€™æ¨£æˆ‘å€‘æ‰èƒ½è§€å¯Ÿå¾—åˆ°é€²åº¦æ¢æœ‰æ²’æœ‰ä½œç”¨ã€‚

```
    $ json-server --watch db.json --delay 2000
```

ç¾åœ¨å¯ä»¥åœ¨ç€è¦½å™¨çœ‹åˆ°é€²åº¦æ¢å•¦ï½

![](assets/Ch07/07.gif)

























